using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.SceneManagement;
using TMPro;

public class Playercontroller : MonoBehaviour
{
   
    public float speed;
    public Rigidbody2D rb;
    public Vector2 Direction;
    private bool OnGround = true;
    public float jump;
    public int coin;
    public TextMeshProUGUI cointext;
    public static Playercontroller instance;
    public int playerHealth;
    public float knockback;
    public bool StartTimer;
    public float Countdown;
    public int maxHealth;
   
    public static int totalScore;
    public int savescore;
    public bool broke;
    public HealthBar healthBar;
    public int setcoin;
    public GameObject deathpanel;
   




    // Start is called before the first frame update

    private void Awake()
    {

        if (instance != null)
        {
            Debug.LogError("Only have one playercontroller script per scene");
            return;
        }

        instance = this;

        if (!broke) 
        {
            setcoin = PlayerPrefs.GetInt("coinnum");
            coin = setcoin;
        }

        
    }

    void Start()

    {
        GetComponent<Rigidbody>();

        playerHealth = maxHealth;
        healthBar.SetMaxHealth(maxHealth);

        deathpanel.SetActive(false);

        
    }


    // Update is called once per frame
    void Update()
    {
        Movement();
        cointext.text = coin.ToString();
        if (playerHealth <= 0)
        {
            deathpanel.SetActive(true);
        }

        if (StartTimer == true)
        {
            if (Countdown <= 0)
            {
                StartTimer = false;
                Countdown = 0.5f;
            }
            Countdown -= Time.deltaTime;

        }

       

       
    }

    private void Movement()
    {
        if (!StartTimer)
        {


            float MoveHorizontal = Input.GetAxis("Horizontal");
            transform.Translate(Direction * Time.deltaTime * speed * MoveHorizontal);



            if (Input.GetKeyDown(KeyCode.W) && OnGround == true)
            {
                rb.velocity = new Vector2(rb.velocity.x, jump);
                OnGround = false;
            }

            if (Input.GetKey(KeyCode.A))
            {
                transform.localScale = new Vector2(-1, 1);

            }
            if (Input.GetKey(KeyCode.D))
            {
                transform.localScale = new Vector2(1, 1);

            }
        }

    }


    private void OnCollisionEnter2D(Collision2D collision)
    {
        
        if (collision.gameObject.tag == "ground")
        {
            OnGround = true;
        }

      

        
    }

    private void OnTriggerEnter2D(Collider2D collision)
    {
        if (collision.gameObject.tag == "pickup")
        {
            Destroy(collision.gameObject);
            coin += 1;
        }
    }

    public void TakeDamage(int damage)
    {
        playerHealth -= damage;
        rb.velocity = new Vector2(-knockback, rb.velocity.y);
        StartTimer = true;
        healthBar.SetHealth(playerHealth);

       

    }

   
    public void meowmeow()
    {
        savescore = coin;
        PlayerPrefs.SetInt("coinnum", savescore);
    }
}
